export function xDomainCookie(o, e, n, i, t, a) { "//" === o.substr(0, 2) && (o = ("https:" === window.location.protocol ? "https:" : "http:") + o); var r = e || "xdsc", c = i || 6e3, s = !1, u = !1, _ = [], d = {}, l = (new Date).getTime(), m = 30, f = !!n, p = !!t, g = !!a; function w() { g && (arguments[0] = ":XDC_PAGE: " + arguments[0], console.log.apply(console, arguments)) } function v(o) { _.push(o), y() } function y() { if (u || s) for (; _.length > 0;)_.pop()(u) } function k(e, n, i) { if (!s && !u) return _.push(function () { k(e, n, i) }); i = i || m, i = null == n ? -100 : i, f || function (o, e, n) { var i = new Date; i.setTime(i.getTime() + 1e3 * n * 60 * 60 * 24); var t = o + "=" + e + "; expires=" + i.toUTCString() + (p ? ";secure" : ""); w("_set_local_cookie", t), document.cookie = t }(e, n, i), u || function (e, n, i) { var t = { namespace: r, msg_type: "xdsc_write", cookie_name: e, cookie_val: n, expires_days: i, secure_only: p }; w("_set_cookie_in_iframe", t), document.getElementById("xdomain_cookie_" + l).contentWindow.postMessage(JSON.stringify(t), o) }(e, n, i), d[e] = n } window.addEventListener("message", function (e) { w("_inbound_postmessage", e.origin, e.data); var n = e.origin || e.originalEvent.origin; if (o.substr(0, n.length) === n && "string" == typeof e.data) { var i = null; try { i = JSON.parse(e.data) } catch (o) { } "object" != typeof i || i instanceof Array || "msg_type" in i && "xdsc_read" === i.msg_type && "namespace" in i && i.namespace === r && (d = i.cookies, s = !0, y()) } }); var x = document.createElement("iframe"); x.style.display = "none", x.id = "xdomain_cookie_" + l; var h = window.location.origin; h || (h = window.location.protocol + "//" + window.location.hostname + (window.location.port ? ":" + window.location.port : "")); var b = { namespace: r, window_origin: h, iframe_origin: o, debug: g }; return x.src = o + "/xdomain_cookie.html#" + encodeURIComponent(JSON.stringify(b)), document.body.appendChild(x), w("creating iframe", x.src), setTimeout(function () { s || (w("_iframe_load_error_occured"), u = !0, y()) }, c), { get: function (o, e, n) { function i(e, i, t) { w("_get_xdomain_cookie_value D", e, i), k(o, i, n), "function" == typeof t && t(i) } if (n = n || m, w("_get_xdomain_cookie_value A", o), !f) { var t = function (o) { for (var e = o + "=", n = document.cookie.split(";"), i = 0; i < n.length; i++) { var t = n[i].trim(); if (0 === t.indexOf(e)) return decodeURIComponent(t.substring(e.length, t.length)) } return "" }(o); if (t) return w("_get_xdomain_cookie_value B", t), v(function (o) { i(!o, t) }), e(t) } v(function (n) { if (w("_get_xdomain_cookie_value C", n), n) return i(!1, null, e); i(!n, o in d ? d[o] : null, e) }) }, set: k } }